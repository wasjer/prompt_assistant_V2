# 项目核心约束与架构规则 (Project Rules)

## 核心架构原则

1. **严格目录隔离 (Strict Architecture)**
   - 项目仅包含三个完全独立的工作区：`extension` (Chrome 插件), `api` (后端接口), `dashboard` (管理后台)
   - 严禁跨目录直接引用代码或依赖
   - 三个工作区完全独立，避免相互打包

2. **插件极轻量 (Extension Limits)**
   - `extension` 必须极轻量，使用 Manifest V3 和纯原生 JS（零依赖，无 npm 包）
   - 绝对禁止将 `node_modules`、重型前端框架（如完整的 React/Next.js）或大型组件库打包进插件产物中
   - 插件核心职责：捕获 Prompt、识别平台、打时间戳、POST 发送数据。仅此而已
   - 插件体积必须 < 5MB（目标 < 2MB）

3. **核心逻辑后置 (Backend & Dashboard Duties)**
   - 数据存储、敏感词匹配引擎、企业审计逻辑，必须全部放在 `api` 端实现
   - 数据浏览、删除、筛选、批量导出 CSV 等复杂界面，必须放在独立部署的 `dashboard` 中
   - 插件内不包含任何管理后台界面
   - 所有数据存储必须在 `api` 端，插件不直接操作数据库

4. **统一数据标准 (Fixed Schema)**
   - 核心数据流转严格遵循以下字段规范：`id`, `userId`, `model`, `url`, `ts` (timestamp), `prompt`, `flagged` (boolean), `hitTerms` (array)
   - 所有 API 接口必须遵循此数据标准

5. **渐进式开发 (Step-by-Step Workflow)**
   - 每次对话只修改单个文件或实现单个小功能
   - 必须确保当前模块可运行且测试通过后，再进入下一步
   - 适配新 AI 平台（如从 ChatGPT 扩展到 Gemini）时，必须复用统一的捕获管道（Capture Pipeline）
   - 如遇报错，优先由开发者手动修复，并明确告知 AI 以此为范例更新上下文

6. **文档驱动 (Docs First)**
   - 任何架构级别的变更或数据表调整，必须先更新项目的设计文档，然后再生成代码
   - 架构变更必须先更新设计文档

## 关键约束

- **插件体积**：必须 < 5MB（目标 < 2MB）
- **插件职责**：仅捕获 Prompt、识别平台、打时间戳、POST 发送数据
- **数据存储**：所有数据存储必须在 `api` 端，插件不直接操作数据库
- **管理界面**：必须在独立的 `dashboard` 中，不打包进插件
- **技术栈**：插件端纯 Vanilla JS，绝对禁止引入大型框架或 npm 包
- **开发流程**：每次对话只修改单个文件或实现单个小功能
- **数据标准**：严格遵循 `id`, `userId`, `model`, `url`, `ts`, `prompt`, `flagged`, `hitTerms`
- **文档优先**：架构变更必须先更新设计文档